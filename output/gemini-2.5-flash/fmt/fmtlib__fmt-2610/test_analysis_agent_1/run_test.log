2025-07-08 07:05:56,363 - INFO - Checking if image fmtlib__fmt-2610-dockerfile1:latest exists locally...
2025-07-08 07:05:56,445 - INFO - Image fmtlib__fmt-2610-dockerfile1:latest found locally.
2025-07-08 07:05:56,445 - INFO - Creating container for fmtlib__fmt-2610...
2025-07-08 07:05:56,898 - INFO - Container for fmtlib__fmt-2610 started: a2d90f42ee073ba03c5a98668e650686fe75d90308781674bd55af100e324135
2025-07-08 07:05:56,898 - INFO - Intermediate patch for fmtlib__fmt-2610 written to /home/sahrish/Desktop/swe-bench/swe-factory-local/output/gemini-2.5-flash/fmt/fmtlib__fmt-2610/test_analysis_agent_1/patch.diff, now applying to container...
2025-07-08 07:05:57,158 - INFO - Failed to apply patch to container, trying again...
2025-07-08 07:05:57,226 - INFO - Apply patch success:
patching file include/fmt/core.h

2025-07-08 07:05:57,327 - INFO - Git diff before:
diff --git a/include/fmt/core.h b/include/fmt/core.h
index bb56da7f..e2abdece 100644
--- a/include/fmt/core.h
+++ b/include/fmt/core.h
@@ -1372,8 +1372,11 @@ template <typename Context> struct arg_mapper {
   // the C array overload.
   template <
       typename T,
-      FMT_ENABLE_IF(std::is_convertible<const T&, const void*>::value &&
-                    !std::is_convertible<const T&, const char_type*>::value)>
+      FMT_ENABLE_IF(
+          std::is_member_pointer<T>::value ||
+          std::is_function<typename std::remove_pointer<T>::type>::value ||
+          (std::is_convertible<const T&, const void*>::value &&
+           !std::is_convertible<const T&, const char_type*>::value))>
   FMT_CONSTEXPR auto map(const T&) -> unformattable_pointer {
     return {};
   }
2025-07-08 07:05:57,327 - INFO - Eval script for fmtlib__fmt-2610 written to /home/sahrish/Desktop/swe-bench/swe-factory-local/output/gemini-2.5-flash/fmt/fmtlib__fmt-2610/test_analysis_agent_1/patch.diff, now applying to container...
2025-07-08 07:07:12,817 - INFO - Test output for fmtlib__fmt-2610 written to /home/sahrish/Desktop/swe-bench/swe-factory-local/output/gemini-2.5-flash/fmt/fmtlib__fmt-2610/test_analysis_agent_1/test_output.txt
2025-07-08 07:07:12,960 - INFO - Git diff after:
diff --git a/include/fmt/core.h b/include/fmt/core.h
index bb56da7f..e2abdece 100644
--- a/include/fmt/core.h
+++ b/include/fmt/core.h
@@ -1372,8 +1372,11 @@ template <typename Context> struct arg_mapper {
   // the C array overload.
   template <
       typename T,
-      FMT_ENABLE_IF(std::is_convertible<const T&, const void*>::value &&
-                    !std::is_convertible<const T&, const char_type*>::value)>
+      FMT_ENABLE_IF(
+          std::is_member_pointer<T>::value ||
+          std::is_function<typename std::remove_pointer<T>::type>::value ||
+          (std::is_convertible<const T&, const void*>::value &&
+           !std::is_convertible<const T&, const char_type*>::value))>
   FMT_CONSTEXPR auto map(const T&) -> unformattable_pointer {
     return {};
   }
diff --git a/test/compile-error-test/CMakeLists.txt b/test/compile-error-test/CMakeLists.txt
index 8202f279..44bbb1ab 100644
--- a/test/compile-error-test/CMakeLists.txt
+++ b/test/compile-error-test/CMakeLists.txt
@@ -67,6 +67,12 @@ expect_compile_error("
   fmt::format(\"{}\", S());
 ")
 
+# Formatting a function
+expect_compile_error("
+  void (*f)();
+  fmt::format(\"{}\", f);
+")
+
 # Make sure that compiler features detected in the header
 # match the features detected in CMake.
 if (SUPPORTS_USER_DEFINED_LITERALS)
diff --git a/test/core-test.cc b/test/core-test.cc
index da3bc0f9..4f39c7ab 100644
--- a/test/core-test.cc
+++ b/test/core-test.cc
@@ -770,6 +770,13 @@ TEST(core_test, is_formattable) {
   static_assert(!fmt::is_formattable<unsigned char*, wchar_t>::value, "");
   static_assert(!fmt::is_formattable<const signed char*, wchar_t>::value, "");
   static_assert(!fmt::is_formattable<const unsigned char*, wchar_t>::value, "");
+
+  static_assert(!fmt::is_formattable<void (*)()>::value, "");
+
+  struct s;
+
+  static_assert(!fmt::is_formattable<int(s::*)>::value, "");
+  static_assert(!fmt::is_formattable<int (s::*)()>::value, "");
 }
 
 TEST(core_test, format) { EXPECT_EQ(fmt::format("{}", 42), "42"); }
2025-07-08 07:07:12,960 - INFO - Git diff changed after running eval script
2025-07-08 07:07:12,960 - INFO - Attempting to stop container fmtlib__fmt-2610-test1...
2025-07-08 07:07:28,243 - INFO - Attempting to remove container fmtlib__fmt-2610-test1...
2025-07-08 07:07:28,426 - INFO - Container fmtlib__fmt-2610-test1 removed.
2025-07-08 07:07:28,426 - INFO - Attempting to remove image fmtlib__fmt-2610-dockerfile1:latest...
2025-07-08 07:07:29,488 - INFO - Image fmtlib__fmt-2610-dockerfile1:latest removed.
