{
    "task_id": "catchorg__Catch2-2187",
    "setup_info": {
        "repo_path": "testbed/catchorg__Catch2-2187_2025-06-29_23-16-37",
        "repo_cache_path": "testbed/catchorg/Catch2_cache"
    },
    "task_info": {
        "repo": "catchorg/Catch2",
        "pull_number": 2187,
        "instance_id": "catchorg__Catch2-2187",
        "issue_numbers": [
            "1390"
        ],
        "base_commit": "2cb5210caf35bf8fc29ade2e5570cc0f37537951",
        "patch": "diff --git a/src/catch2/internal/catch_run_context.cpp b/src/catch2/internal/catch_run_context.cpp\n--- a/src/catch2/internal/catch_run_context.cpp\n+++ b/src/catch2/internal/catch_run_context.cpp\n@@ -230,9 +230,11 @@ namespace Catch {\n         if (result.getResultType() == ResultWas::Ok) {\n             m_totals.assertions.passed++;\n             m_lastAssertionPassed = true;\n-        } else if (!result.isOk()) {\n+        } else if (!result.succeeded()) {\n             m_lastAssertionPassed = false;\n-            if( m_activeTestCase->getTestCaseInfo().okToFail() )\n+            if (result.isOk()) {\n+            }\n+            else if( m_activeTestCase->getTestCaseInfo().okToFail() )\n                 m_totals.assertions.failedButOk++;\n             else\n                 m_totals.assertions.failed++;\n",
        "test_patch": "diff --git a/src/catch2/catch_test_macros.hpp b/src/catch2/catch_test_macros.hpp\n--- a/src/catch2/catch_test_macros.hpp\n+++ b/src/catch2/catch_test_macros.hpp\n@@ -32,8 +32,8 @@\n \n   #define CATCH_CHECK( ... ) INTERNAL_CATCH_TEST( \"CATCH_CHECK\", Catch::ResultDisposition::ContinueOnFailure, __VA_ARGS__ )\n   #define CATCH_CHECK_FALSE( ... ) INTERNAL_CATCH_TEST( \"CATCH_CHECK_FALSE\", Catch::ResultDisposition::ContinueOnFailure | Catch::ResultDisposition::FalseTest, __VA_ARGS__ )\n-  #define CATCH_CHECKED_IF( ... ) INTERNAL_CATCH_IF( \"CATCH_CHECKED_IF\", Catch::ResultDisposition::ContinueOnFailure, __VA_ARGS__ )\n-  #define CATCH_CHECKED_ELSE( ... ) INTERNAL_CATCH_ELSE( \"CATCH_CHECKED_ELSE\", Catch::ResultDisposition::ContinueOnFailure, __VA_ARGS__ )\n+  #define CATCH_CHECKED_IF( ... ) INTERNAL_CATCH_IF( \"CATCH_CHECKED_IF\", Catch::ResultDisposition::ContinueOnFailure | Catch::ResultDisposition::SuppressFail, __VA_ARGS__ )\n+  #define CATCH_CHECKED_ELSE( ... ) INTERNAL_CATCH_ELSE( \"CATCH_CHECKED_ELSE\", Catch::ResultDisposition::ContinueOnFailure | Catch::ResultDisposition::SuppressFail, __VA_ARGS__ )\n   #define CATCH_CHECK_NOFAIL( ... ) INTERNAL_CATCH_TEST( \"CATCH_CHECK_NOFAIL\", Catch::ResultDisposition::ContinueOnFailure | Catch::ResultDisposition::SuppressFail, __VA_ARGS__ )\n \n   #define CATCH_CHECK_THROWS( ... )  INTERNAL_CATCH_THROWS( \"CATCH_CHECK_THROWS\", Catch::ResultDisposition::ContinueOnFailure, __VA_ARGS__ )\n@@ -123,8 +123,8 @@\n \n   #define CHECK( ... ) INTERNAL_CATCH_TEST( \"CHECK\", Catch::ResultDisposition::ContinueOnFailure, __VA_ARGS__ )\n   #define CHECK_FALSE( ... ) INTERNAL_CATCH_TEST( \"CHECK_FALSE\", Catch::ResultDisposition::ContinueOnFailure | Catch::ResultDisposition::FalseTest, __VA_ARGS__ )\n-  #define CHECKED_IF( ... ) INTERNAL_CATCH_IF( \"CHECKED_IF\", Catch::ResultDisposition::ContinueOnFailure, __VA_ARGS__ )\n-  #define CHECKED_ELSE( ... ) INTERNAL_CATCH_ELSE( \"CHECKED_ELSE\", Catch::ResultDisposition::ContinueOnFailure, __VA_ARGS__ )\n+  #define CHECKED_IF( ... ) INTERNAL_CATCH_IF( \"CHECKED_IF\", Catch::ResultDisposition::ContinueOnFailure | Catch::ResultDisposition::SuppressFail, __VA_ARGS__ )\n+  #define CHECKED_ELSE( ... ) INTERNAL_CATCH_ELSE( \"CHECKED_ELSE\", Catch::ResultDisposition::ContinueOnFailure | Catch::ResultDisposition::SuppressFail, __VA_ARGS__ )\n   #define CHECK_NOFAIL( ... ) INTERNAL_CATCH_TEST( \"CHECK_NOFAIL\", Catch::ResultDisposition::ContinueOnFailure | Catch::ResultDisposition::SuppressFail, __VA_ARGS__ )\n \n   #define CHECK_THROWS( ... )  INTERNAL_CATCH_THROWS( \"CHECK_THROWS\", Catch::ResultDisposition::ContinueOnFailure, __VA_ARGS__ )\ndiff --git a/tests/SelfTest/UsageTests/Misc.tests.cpp b/tests/SelfTest/UsageTests/Misc.tests.cpp\n--- a/tests/SelfTest/UsageTests/Misc.tests.cpp\n+++ b/tests/SelfTest/UsageTests/Misc.tests.cpp\n@@ -182,6 +182,39 @@ TEST_CASE( \"checkedElse, failing\", \"[failing][.]\" ) {\n     REQUIRE( testCheckedElse( false ) );\n }\n \n+TEST_CASE(\"Testing checked-if\", \"[checked-if]\") {\n+    CHECKED_IF(true) {\n+        SUCCEED();\n+    }\n+    CHECKED_IF(false) {\n+        FAIL();\n+    }\n+    CHECKED_ELSE(true) {\n+        FAIL();\n+    }\n+    CHECKED_ELSE(false) {\n+        SUCCEED();\n+    }\n+}\n+\n+TEST_CASE(\"Testing checked-if 2\", \"[checked-if][!shouldfail]\") {\n+    CHECKED_IF(true) {\n+        FAIL();\n+    }\n+    // If the checked if is not entered, this passes and the test\n+    // fails, because of the [!shouldfail] tag.\n+    SUCCEED();\n+}\n+\n+TEST_CASE(\"Testing checked-if 3\", \"[checked-if][!shouldfail]\") {\n+    CHECKED_ELSE(false) {\n+        FAIL();\n+    }\n+    // If the checked false is not entered, this passes and the test\n+    // fails, because of the [!shouldfail] tag.\n+    SUCCEED();\n+}\n+\n TEST_CASE( \"xmlentitycheck\" ) {\n     SECTION( \"embedded xml: <test>it should be possible to embed xml characters, such as <, \\\" or &, or even whole <xml>documents</xml> within an attribute</test>\" ) {\n         SUCCEED(); // We need this here to stop it failing due to no tests\n",
        "problem_statement": "Make CHECKED_IF and CHECKED_ELSE \"ok to fail\"\n## Description\r\nBoth `CHECKED_IF` and `CHECKED_ELSE` are currently fairly obscure macros that simplify using `if`/`else` in tests.\r\n\r\nHowever, entering the `else` branch fails the test in which it occurs, because they are not marked as being ok to fail (tagged with `Catch::ResultDisposition::SuppressFail` to be exact). This behaviour makes them less than useful, but with a change they should be actually usable.\r\n\r\nMilestone 3.0, because it is a theoretically breaking change.\r\n\n",
        "hints_text": "First of all, awesome work with Catch2, THE best testing framework out there. This thread is particularly useful as currently I'm testing with MPI communication whose number of processors is known only at runtime. By adding CHECKED_IF( num_of_procs > 4 ) I can prevent MPI failure on small core machines without having to comment out these tests. Really looking forward to this tweak.",
        "created_at": "2021-03-12T19:19:22Z",
        "version": "3.0"
    }
}